---
title: 没有使用TDD和代码审查的沉重代价
categories:
    - frontend
    - translate
tag:
    - TDD
    - 持续集成
    - CI
    - test
---

[原文链接](https://medium.com/javascript-scene/the-outrageous-cost-of-skipping-tdd-code-reviews-57887064c412#.rg4tr1k04https://medium.com/javascript-scene/the-outrageous-cost-of-skipping-tdd-code-reviews-57887064c412#.rg4tr1k04)


最近几年，越来越多的公司邀请我去演讲关于测试驱动开发(TDD)的好处，并分享关于如何实现更高质量产品代码的实践。

TDD是一种在编写代码之前先写自动化测试来确保代码正常的工作流程。你编写一个测试，看着它失败，然后再编写代码，看着它通过，并且在需要的时候重构。构建系统时时刻重复这个工程。

该模式已经被深入研究，并证明它是提高软件代码质量的有效方式。然而你知道它还能为组织节省一大笔时间和金钱吗？

经理推脱没有实现TDD的最主要原因是成本。通常使用TDD去初始化一个项目需要多花费超过30%的时间。

这些经理需要知道的是TDD减少了产品阶段约40%-80%的bug, 并使软件发生了质变。在产品中，更多的bug导致维护成本戏剧性的提升。

根据IBM系统科学研究所，修复一个产品阶段bug是修复一个设计阶段bug的时间的100倍以上，是修复一个开发阶段bug的15倍以上。

<img src="https://cdn-images-1.medium.com/max/800/1*jOS7CZX-gWfOoKGPUU29kg.png">

通过这些图表，让我们来了解一个虚构案例在使用和不使用TDD时的相关花销。不算维护，不使用TDD的领先1000个小时。

<img src="https://cdn-images-1.medium.com/max/800/1*4KJ9RSNP4_JsnGYjVxwnlw.png">

在我们虚构的示例中，我们节省了623个工作时，以一个4人小队来说，大约是一个月的开发量。如果我们向每个开发者支付美国平均水平的工资($95K)，并考虑到30%左右的福利，我们几乎节省了$37000 USD。

当然，这是一个包含了很多假设的虚构案例。你的实际开销可能会被很多因素影响，包括团队TDD开发的经验，有无其他质量管理措施（比如代码审查），等等。
 
这是我们的假设：

- 没有使用TDD的产品阶段bug数量：100
- 使用TDD的产品阶段bug数量：40（减少60%，40%-80%的中间值）
- 使用TDD修复开发阶段bug的平均时间：1小时（这个数字仅用于导出修复产品阶段bug的开销）
- 修复产品阶段bug的平均时间：15小时

利用这些数据可以轻易的得出结论。考虑维护成本的情况下，TDD毋庸置疑的节省了时间和金钱。

基于我在真实项目中使用和未使用TDD的经验，与此相关的虚构案例的结果也是真实的。

### 代码审查有类似的功效

代码审查有类似的功效。实际上，一些研究表明它比TDD更有效。根据一个1988年的研究，__用在代码审查的一小时节省了维护时间的33个小时__。

这是让人惊讶的，但是不要用你个人的经历去捏造代码审查在捕获bug上的收益。我发现自动化测试在捕获bug上更加有效，所以如何解释代码审查那非凡的效率。

__知识共享__。但我们采用代码审查时，其他开发者使用反模式和不良实践时，你的团队将会自我纠正。同时，他们还会相互分享最佳实践，教会他人更好的方式，写可读性更高的代码。

结果就是高级开发人员会迅速提升团队中最聪明的开发者的能力，整个团队也会提升。在团队中，再怎么强调导师文化的价值也不过分。

### 中断的开销

为什么修复产品阶段bug需要更多的时间？因为一旦一个bug出现在产品阶段，开销远不止修复一个bug。

修复一个产品阶段bug比修复开发阶段的bug要昂贵的多。去理解他们的差别，你需要先明白中断一个开发者的开销。

一个产品阶段的bug修复往往意味着中断当前功能开发的上下文和节奏。换句话说，开发者被剥离当前工作的开发环境并投入到bug的上下文去，这需要时间去理解相关代码和缺陷，诊断根本原因，修复bug，然后再切换回之前工作的内容中。

每次上下文切换都需要消耗开发者至少20分钟的生产力，但是消耗远不止于此。中断开发者去修复bug很有可能会导致原来的工作中产生新的bug。根据微软的研究，相对于没有中断的任务，被中断的任务需要花费两倍的时间去完成，并且bug率也倍增了。

换句话说，修复已经发布的产品bug的开销不仅仅包含修复bug。中断增加了当前工作的开销，并导致了更多隐藏的bug需要被修复。

因此，多线程工作并不是一个好主意。开发者需要专注于一件事情来提高生产力。

### 结论

下次有人告诉你他们没有时间或者预算来使用TDD或者代码审查，自信的告诉他们，“这种情况下，你们真的没有时间或预算来跳过TDD”。

### 下一步

更好的掌握TDD并理解它在软件开发工作中的角色：

- [关于TDD和单元测试的5个常见问题](https://medium.com/javascript-scene/5-common-misconceptions-about-tdd-unit-tests-863d5beb3ce9)

- [单元、功能、集成测试对比](https://www.sitepoint.com/javascript-testing-unit-functional-integration/)

- [每个单元测试必问的5个问题](https://medium.com/javascript-scene/what-every-unit-test-needs-f6cd34d9836d)

- [网络视频:ES6中的TDD和React开发](https://ericelliottjs.com/product/tdd-es6-react/)

- 让你的团队获得我亲自指导，联系我们并告诉我们关于你团队的信息和你们训练的需求


